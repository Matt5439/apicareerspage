<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Post</title>
    <style>
        /* Add your styles here */
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1, h2 {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1 id="jobTitle"></h1>
    <div id="jobContent"></div>

    <h2>Apply for this Position</h2>
    <form id="applicationForm" method="POST" action="!!REQUEST MUST BE PROXIED ON YOUR SERVERS!!">
        <input type="hidden" name="id" value="" />
        <label>First Name <input type="text" name="first_name" required /></label><br/>
        <label>Last Name <input type="text" name="last_name" required /></label><br/>
        <label>Email <input type="email" name="email" required /></label><br/>
        <input type="submit" value="Submit Application" />
    </form>

    <script>
        const boardToken = 'your_board_token'; // Replace with your actual board token
        const urlParams = new URLSearchParams(window.location.search);
        const jobId = urlParams.get('gh_jid'); // Extract job ID from URL

        async function fetchJobPost() {
            const apiUrl = `https://boards-api.greenhouse.io/v1/boards/${boardToken}/jobs/${jobId}?questions=true`;

            try {
                const response = await fetch(apiUrl);
                const jobData = await response.json();
                document.getElementById('jobTitle').textContent = jobData.title;
                document.getElementById('jobContent').innerHTML = jobData.content;
                document.querySelector('input[name="id"]').value = jobData.id; // Set job ID in the form
            } catch (error) {
                console.error('Error fetching job post:', error);
                alert('Failed to load job post. Please try again later.');
            }
        }

        document.getElementById('applicationForm').onsubmit = async function(event) {
            event.preventDefault(); // Prevent default form submission

            const formData = new FormData(this);
            const apiUrl = `https://boards-api.greenhouse.io/v1/boards/${boardToken}/jobs/${formData.get('id')}/applications`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Authorization': '069363c6934e0c9577e34e7629b88b49-3', // Replace with your API key
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        first_name: formData.get('first_name'),
                        last_name: formData.get('last_name'),
                        email: formData.get('email')
                    })
                });

                if (!response.ok) {
                    throw new Error(`Error! status: ${response.status}`);
                }

                const result = await response.json();
                alert('Application submitted successfully!'); // Notify user of success
                console.log(result);
            } catch (error) {
                console.error('Error submitting application:', error);
                alert('Failed to submit application. Please try again.');
            }
        };

        // Fetch job details when the page loads
        window.onload = fetchJobPost;
    </script>
</body>
</html>

